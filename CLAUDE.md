# CLAUDE.md

## Build & Dev Commands

- `npm run dev` — Start development server
- `npm run build` — Production build (standalone output)
- `npm run start` — Start production server
- `npm run lint` — Run ESLint

No test framework is configured.

## Tech Stack

- **Framework:** Next.js 16.1.3 (App Router) with React 19.2.3
- **Language:** TypeScript (strict mode)
- **Database:** Supabase (PostgreSQL + Storage)
- **Styling:** Tailwind CSS 4 with tailwind-merge and clsx
- **Animation:** Framer Motion
- **Icons:** lucide-react
- **Dates:** date-fns
- **Excel parsing:** xlsx
- **Deployment:** Docker (multi-stage, node:20-alpine) on Fly.io

## Architecture

### Route Groups

- `app/(app)/` — Admin pages (dashboard, employees, celebrations). Uses `Navbar` via its layout.
- `app/(landing)/` — Landing/marketing page. Minimal layout without navbar.
- `app/(public)/` — Public pages (contribute, tribute). Minimal layout, no auth required.

### Data Flow

Server components fetch data from the Supabase data layer → render UI. Mutations go through **server actions** in `app/actions/` which call DB functions and `revalidatePath()`.

- `app/lib/supabase/server.ts` — Server Supabase client (uses `@supabase/ssr` + `cookies()`)
- `app/lib/supabase/client.ts` — Browser Supabase client (for client components)
- `app/lib/supabase/admin.ts` — Admin Supabase client (service role key, for Storage)
- `app/lib/types.ts` — TypeScript interfaces (Employee, Celebration, Question, Response, etc.)
- `app/lib/default-questions.ts` — Norwegian default questions per celebration type
- `app/lib/db/employees.ts` — CRUD for employees
- `app/lib/db/celebrations.ts` — CRUD for celebrations with joins
- `app/lib/db/questions.ts` — CRUD for questions
- `app/lib/db/responses.ts` — CRUD for responses
- `app/lib/db/storage.ts` — Image upload/delete via Supabase Storage
- `app/actions/employees.ts` — Employee server actions
- `app/actions/celebrations.ts` — Celebration server actions
- `app/actions/questions.ts` — Question server actions
- `app/actions/responses.ts` — Response/contribution server actions
- `app/actions/import-employees.ts` — Excel import server action

### User Flow

1. Admin imports team from Excel or adds manually
2. Admin creates a celebration (birthday, anniversary, farewell, custom)
3. Admin configures questions (defaults provided per type)
4. Admin shares a link → team members visit `/contribute/[token]`
5. Team members answer questions + upload photos
6. Admin publishes → tribute page generated at `/tribute/[id]`
7. Recipient opens the tribute page

### Celebration Lifecycle

`draft` → `collecting` → `published` → `archived`

- **draft**: Admin configures questions, not yet shared
- **collecting**: Share link is active, team members can contribute
- **published**: Tribute page is live, no more contributions
- **archived**: Hidden from dashboard

## Database

Supabase (PostgreSQL) with the following tables:
- `employees` — team members
- `celebrations` — celebration events linked to employees
- `questions` — configurable questions per celebration
- `responses` — contributor answers (text + optional image)

### Supabase Storage

Bucket: `tribute-images` (public reads, anonymous inserts)
Path convention: `celebrations/{celebration_id}/{response_id}/{filename}`

### Environment Variables

```
NEXT_PUBLIC_SUPABASE_URL=...
NEXT_PUBLIC_SUPABASE_ANON_KEY=...
SUPABASE_SERVICE_ROLE_KEY=...
```

## Key Conventions

- **UI language is Norwegian** — all user-facing text is in Norwegian
- **Path alias:** `@/*` maps to the project root
- **No auth system** — the app has no authentication or authorization
- **IDs:** Generated by Supabase (UUID)
- **Share tokens:** `crypto.randomUUID().slice(0, 10)` for short URL-safe tokens
- **Field naming:** snake_case to match PostgreSQL conventions
- **Design system:** Nordic Editorial theme (`.nord-card`, `.editorial-line`, `.input-field`, amber/gold accents, Playfair + Sora fonts)
- **next.config.ts:** `output: "standalone"` for Docker, `serverActions.bodySizeLimit: '5mb'`

## Deployment

- **Fly.io** app name: `employee-gifting-mvp`, region: `lhr`
- **Docker:** Multi-stage build (deps → builder → runner), runs as non-root `nextjs` user
- **No persistent volume** — all data is in Supabase
- **Port:** 3000
